{% extends "base.html" %}
{% block content %}

<section class="chat-wrapper">

    <div class="chat-users">
        <h3 class="chat-title">Chats</h3>

        {% for chat in chat_users %}
        <a href="{{ url_for('chat_with_user', user_id=chat.user_id) }}" class="chat-user-card">
            <div class="chat-user-info">
                <strong>{{ chat.username }}</strong><br>
                <small>{{ chat.last_message or 'No messages yet' }}</small>
            </div>

            {% if chat.last_message_time %}
                <small class="chat-timestamp">{{ chat.last_message_time }}</small>
            {% endif %}
        </a>
        {% endfor %}
    </div>

    <div class="chat-box">
        {% if active_user %}

        <h3 class="chat-title">{{ active_user.username }}</h3>

        <div class="messages-list">
            {% for msg in chats %}
                <div class="message {% if msg.sender_id == session['user_id'] %}me{% endif %}">
                    <p>{{ msg.message }}</p>
                    <small>{{ msg.created_at }}</small>
                </div>
            {% endfor %}
        </div>

        <form method="POST" class="chat-form">
            <input type="text" name="message" placeholder="Type a message..." required>
            <button class="btn btn-primary">Send</button>
        </form>

        {% else %}

        <div class="no-chat-selected">
            <p>Select a conversation to start chatting.</p>
        </div>

        {% endif %}
    </div>

</section>

{% endblock %}
